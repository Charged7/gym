{% extends "data_head.html" %}
{% block title %}Вiдновлення пароля{% endblock %}
{% block content %}

<div class="form-wrapper">
    <div class="container">
        <h2>Введiть новий пароль</h2>
        <style>
            .container {
                max-width: 400px;
                margin: 50px auto;
                font-family: Arial, sans-serif;
            }

            .password-container {
                position: relative;
            }

            .password-tooltip {
                display: none;
                position: absolute;
                top: 45px;
                left: 0;
                background: #fff;
                border: 1px solid #ddd;
                box-shadow: 0 2px 6px rgba(0,0,0,0.2);
                padding: 10px;
                width: 320px;
                font-size: 14px;
                border-radius: 5px;
                z-index: 10;
            }

            .password-tooltip ul {
                margin: 0;
                padding-left: 20px;
            }

            .password-tooltip li {
                margin: 5px 0;
                color: #555;
            }

            .password-tooltip li.valid {
                color: green;
            }

            .password-tooltip li.invalid {
                color: red;
            }

            .password-input:focus + .password-tooltip {
                display: block;
            }

            .strength-bar {
                display: flex;
                gap: 3px;
                margin-bottom: 5px;
            }

            .strength-bar span {
                flex: 1;
                height: 5px;
                background: #ddd;
                border-radius: 3px;
            }

            .strength-bar span.active.weak { background: red; }
            .strength-bar span.active.medium { background: orange; }
            .strength-bar span.active.strong { background: green; }
        </style>

        <form method="post">
            <div class="container">
                <div class="password-container">
                    <input name="password" type="password"
                        placeholder="Новий пароль"
                        required
                        class="form-control mb-2 password-input">
                    <div class="password-tooltip">
                        <p><strong>Надійність пароля:</strong></p>
                        <div class="strength-bar">
                            <span></span><span></span><span></span>
                        </div>
                        <ul>
                            <li id="length" class="invalid">Мінімум 8 символів</li>
                            <li id="upper" class="invalid">Велика літера (A-Z)</li>
                            <li id="lower" class="invalid">Маленька літера (a-z)</li>
                            <li id="digit" class="invalid">Цифра (0-9)</li>
                            <li id="special" class="invalid">Спецсимвол (!@#$%)</li>
                        </ul>
                    </div>
                </div>

                <input name="confirm_password" type="password"
                    placeholder="Підтвердити пароль"
                    required
                    class="form-control mb-2 confirm-input">


                <button id="submit-btn" type="submit" class="btn btn-success mt-1" disabled>Змiнити пароль</button>
            </div>

            {% if success_message %}
            <div class="alert alert-success mt-3">
                {{ success_message }}
            </div>
            {% endif %}
        </form>
    </div>
</div>

<script>
document.addEventListener("DOMContentLoaded", function() {
    const passwordInput = document.querySelector(".password-input");
    const confirmInput = document.querySelector(".confirm-input");
    const submitBtn = document.getElementById("submit-btn");

    const lengthItem = document.getElementById("length");
    const upperItem = document.getElementById("upper");
    const lowerItem = document.getElementById("lower");
    const digitItem = document.getElementById("digit");
    const specialItem = document.getElementById("special");

    const strengthBars = document.querySelectorAll(".strength-bar span");

    function updateValidation() {
        const val = passwordInput.value;
        const confirmVal = confirmInput.value;

        const lengthValid = val.length >= 8;
        const upperValid = /[A-Z]/.test(val);
        const lowerValid = /[a-z]/.test(val);
        const digitValid = /[0-9]/.test(val);
        const specialValid = /[!@#$%^&*(),.?":{}|<>\-_]/.test(val);

        toggleClass(lengthItem, lengthValid);
        toggleClass(upperItem, upperValid);
        toggleClass(lowerItem, lowerValid);
        toggleClass(digitItem, digitValid);
        toggleClass(specialItem, specialValid);

        // Подсчет выполненных правил для прогресс-бара
        const score = [lengthValid, upperValid, lowerValid, digitValid, specialValid].filter(Boolean).length;
        strengthBars.forEach((bar, index) => {
            bar.classList.remove("active", "weak", "medium", "strong");
            if (index < score / 2) {
                bar.classList.add("active", score <= 2 ? "weak" : score === 3 || score === 4 ? "medium" : "strong");
            }
        });

        // Разблокировка кнопки
        submitBtn.disabled = !(lengthValid && upperValid && lowerValid && digitValid && specialValid);
    }

    passwordInput.addEventListener("input", updateValidation);
    confirmInput.addEventListener("input", updateValidation);

    function toggleClass(element, isValid) {
        element.classList.remove("valid", "invalid");
        element.classList.add(isValid ? "valid" : "invalid");
    }
});
</script>
{% endblock %}
