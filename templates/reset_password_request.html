{% extends "data_head.html" %}
{% include 'menu.html' %}

{% block title %}Запрос вiдновлення пароля{% endblock %}
{% block content %}

<div class="form-wrapper">
    <div class="container">
        <h2>Запрос вiдновлення пароля</h2>
        <form method="post">
            <div class="mt-5 mb-3">
                <label for="gmail" class="mb-2">Введiть email до якого прив'язаний акаунт</label>
                <input type="gmail" class="form-control" name="gmail" value="{{ gmail }}">
                {% if errors.get('gmail') %}
                <div class="text-danger">{{ errors['gmail'] }}</div>
                {% endif %}
            </div>

            <button id="reset-btn" type="submit" class="btn btn-warning">Вiдправити посилання</button>

            <p class="mt-2">
                <span id="timer-text"></span>  <!-- Здесь будет таймер -->
            </p>

            <p class="mt-2">Немає акаунта? <a href="{{ url_for('register') }}">Зареєструватись</a></p>
        </form>
    </div>
</div>

<script>
document.addEventListener("DOMContentLoaded", function() {
    const btn = document.getElementById("reset-btn");

    // Если ты передаёшь в session время последнего запроса:
    const lastRequest = {{ session.get('last_reset_request', 0) | int }};
    const now = Math.floor(Date.now() / 1000);
    let remaining = 60 - (now - lastRequest);

    const timerText = document.getElementById("timer-text");

    function startCountdown(seconds) {
        btn.disabled = true;
        updateTimerText(seconds);

        const timer = setInterval(() => {
            seconds--;
            updateTimerText(seconds);

            if (seconds <= 0) {
                clearInterval(timer);
                btn.disabled = false;
                timerText.textContent = "";
            }
        }, 1000);
    }

    function updateTimerText(seconds) {
        timerText.textContent = `Відправити ще раз? Зачекайте ${seconds} сек`;
    }

    if (remaining > 0) {
        startCountdown(remaining);
    }
}); 
</script>

{% endblock %}
