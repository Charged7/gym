{% extends "data_head.html" %}

{% block title %}Пользователи{% endblock %}
{% block content %}
<link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet">

<div class="form-wrapper">
    <div class="container">
      <h2>Список пользователей</h2>
      <!-- Поиск -->
      <form method="get" action="{{ url_for('users') }}" class="mb-3 container d-flex gap-2">
          <div class="col-auto">
              <input type="text" class="form-control" name="search" placeholder="Поиск по email" value="{{ search_query }}">
          </div>
          <div class="col-auto">
              <button type="submit" class="btn btn-primary">Поиск</button>
          </div>
      </form>

      <!-- Таблица -->
      {% if users %}
      <table class="table" data-update-url="{{ url_for('users') }}">
        <thead>
          <tr>
              <th>ID</th>
              <th>Имя</th>
              <th>Фамилия</th>
              <th>Email</th>
              <th>Номер телефона</th>
              <th>Роль</th>
              <th>Действия</th></tr>
        </thead>
        <tbody>
          {% for id, name, surname, gmail, phone, role in users %}
          <tr data-user-id="{{ id }}">
            <td>{{ id }}</td>

            <td>
              <span class="text-view">{{ name }}</span>
              <input name="name" class="edit-input form-control form-control-sm d-none" value="{{ name }}">
            </td>

            <td>
              <span class="text-view">{{ surname }}</span>
              <input name="surname" class="edit-input form-control form-control-sm d-none" value="{{ surname }}">
            </td>

            <td>
              <span class="text-view">{{ gmail }}</span>
              <input name="gmail" class="edit-input form-control form-control-sm d-none" value="{{ gmail }}">
            </td>

            <td>
              <span class="text-view">{{ phone }}</span>
              <input name="phone" class="edit-input form-control form-control-sm d-none" value="{{ phone }}">
            </td>

            <td>
              <span class="text-view">{{ role }}</span>
              <select name="role" class="edit-input form-select form-select-sm d-none">
                <option value="client" {% if role == 'client' %}selected{% endif %}>Клиент</option>
                <option value="trainer" {% if role == 'trainer' %}selected{% endif %}>Тренер</option>
                <option value="admin" {% if role == 'admin' %}selected{% endif %}>Админ</option>
              </select>
            </td>

            <td>
              <button type="button" class="btn btn-primary btn-sm btn-edit">Редактировать</button>
              <button type="button" class="btn btn-success btn-sm btn-save d-none">Сохранить</button>

              <form method="post" class="d-inline ms-2">
                <input type="hidden" name="action" value="delete">
                <input type="hidden" name="user_id" value="{{ id }}">
                <button type="submit" class="btn btn-danger btn-sm" onclick="return confirm('Удалить пользователя {{ gmail }}?')">Удалить</button>
              </form>
            </td>
          </tr>
          {% endfor %}
        </tbody>
      </table>
      {% else %}
        <p>Пользователь не найден</p>
      {% endif %}
    </div>
</div>

{% endblock %}
